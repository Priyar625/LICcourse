## Experiment-3 : Design and Analysis of MOS differential amplifier circuit
## Aim of the experiment: Design and analyse differential amplifier circuit for the following specifications:
## design question
VDD= 2.2V , P<=2.2mW , Vincm =1.2V , Vocm = 1.25V , Vp = 0.4V Perform: DC analysis, transient analysis, frequency response and extract the parameters.
solution: we know that P= VddIss 

Iss = P/Vdd = 2.2mW/2.2V = 1mA

Iss = 1mA

ID = Iss/2 = 1m/2 =0.5mA

ID = 0.5mA

(from VDD = IDRD + Vocm)

RD = (VDD - Vocm)/ID 

RD = (2.2-1.25)/0.5m = 1.9Kohm

RD = 1.9Kohm

Rss = Vp/Iss = 0.4/1m = 400ohm

 Rss = 400ohm

## circuit diagram:

A)With Resistor Rss

![Image](https://github.com/user-attachments/assets/c5af35e1-b7e7-46fb-b2f6-1d6e87a24baa)


B) Resistor Rss replaced with current source Iss

![Image](https://github.com/user-attachments/assets/dc943035-c6b9-4506-abb8-ec60469c6384)

C) Resistor Rss replaced with NMOSFET

![Image](https://github.com/user-attachments/assets/24fda4ed-8ffa-4cef-ac81-d074c0d0fd79)

## Analysis of the circuit

Design and analysis

A) With Resistor Rss:
The circuit is intended to eliminate common-mode signals.

It amplifies only the differential signal between VinCM1 and VinCM2.

The output voltage range is restricted by the supply voltage (VDD) and the transistor's saturation conditions.

1.DC Analysis- To fix the operating point (Q-point):

![Image](https://github.com/user-attachments/assets/c5af35e1-b7e7-46fb-b2f6-1d6e87a24baa)

![Image](https://github.com/user-attachments/assets/629f36cc-e80f-4b29-920b-79661ab7267c)

![Image](https://github.com/user-attachments/assets/8a77f448-3183-4958-b585-f9eddcffca64)

Length( of M1 and M2) = L = 180nm

Width ( of M! and M2) = W = 6.4125um

To verify the mosfets are in saturation region : VGD <= VTn

(1.2V -1.25V) <= 0.495V

-0.05V <= 0.495V

and VDS >= Vov

(1.25 - 0.4) >= (1.2 - 0.4) - 0.495

0.85V >= 0.305V

Therefore mosfets are in saturation region .

The Q-points of both the mosfets(M1 and M2) are (0.85V, 0.5mA)

 If the value of the vicm increase from the Vincm to 1.3V from 1.2V (0.1V increase), these are the respective changes.


![Image](https://github.com/user-attachments/assets/96d25d51-dce2-4a05-8bcb-5291352086a6)


![Image](https://github.com/user-attachments/assets/b9bafbd5-63b5-4c97-9675-c1ea1067817e)

so, there is a slight variation in the Q-point as (0.644V, 0.576mA)

##Transient Analysis: 

In LTSpice, transient analysis is used to model how a circuit responds over time to varying inputs like pulses, sine waves, or step functions. 
This type of analysis is essential in high-speed applications, as it helps assess important factors such as rise time, fall time, and propagation delay, which determine the amplifierâ€™s ability to handle fast signals.
It also examines how the MOSFET reacts to rapid changes in input voltage and load conditions.

nput waveform and output waveform

![Image](https://github.com/user-attachments/assets/0716736e-445c-43b4-af4a-1f2dd032573f)

![Image](https://github.com/user-attachments/assets/5fc4bd2c-2757-4479-a767-5a743a7565f2)

From the graph ,we can observe the 180 degree phase shift in the output signal and the output voltage (at Vocm node) is amplified .

 Gain(Av) = Vout_peak/Vin_peak

= 0.199/0.05 = 3.98V/V

From calculations, gm = 2ID/Vov = (2* 0.5m)/ (0.8 - 0.495) = 3.278m

Rout = Rd = 1.9Kohm

Overall gain :Av = gm * Rd

= 3.278m * 1.9K = 6.22V/V.

## 3. AC analysis:

The AC analysis in LTSpice is used to analyze the frequency response of an amplifier, including parameters such as gain, bandwidth, and phase shift.
In this analysis, the MOSFET is modeled as a linear small-signal amplifier, where the drain current responds proportionally to small changes in gate voltage.
By applying a small-signal AC input, this analysis helps us understand how the circuit amplifies signals and how it performs across different frequencies.


![Image](https://github.com/user-attachments/assets/d20816fb-ac4d-4f22-b983-fb3e910ba630)

From the graph , the gain in dB scale is 12.6dB - 3dB = 9.6dB

4. To calculate maximum input swing and output swing
Vincm_min = Vth1 + Vov = 0.495 + 0.4 = 0.895V

Vincm_max = VDD -(RD*Iss)/2 + Vth = 2.2 -(1.9k * 1m)/2 + 0.495 = 1.745V

Therefore Vincm = (Vincm_min + Vincm_max)/2 = 1.32V

and Vocm_min = Vov1 +Vov3 = (0.8 - 0.495) +0.4 = 0.705V

Vocm_max = VDD - IDRD = 2.2 -(0.5m* 1.9K) = 1.25V

Therefore Vocm = (Vocm_min + Vocm_max)/2 = 0.977V




B) Resistor Rss replaced with current source Iss:

Using an active current source in place of R3 enhances both the gain and the Common-Mode Rejection Ratio (CMRR). 
The overall performance of the circuit is improved when R3 is replaced with an active current source.

![Image](https://github.com/user-attachments/assets/d7fc5df6-5a6b-4199-9a8e-05766cf23acb)

![Image](https://github.com/user-attachments/assets/b45daff0-f1f0-4484-a09b-7843cefa1205)


1.DC analysis - To fix the operating point (Q-point):

Mosfet aspect ratio was same ie, L= 180nm, W = 6.4175um

Verified the mosfets are in saturation region by : VGD <=Vtn and VDS >= Vov.

The Q-point of both the mosfets are (0.85V, 0.5mA).

2. Transient analysis:

![Image](https://github.com/user-attachments/assets/db2a9ac2-22b7-437d-b5f6-cc3e2d013010)

![Image](https://github.com/user-attachments/assets/1e84869b-fb4b-46db-98ca-8c2746d0a5be)


From the graph ,we can observe the 180 degree phase shift in the output signal and the output voltage (at Vocm node) is amplified .

Input voltage amplitude given was 50mV.

From the graph,

Overall Gain(Av) = Vout_peak/Vin_peak

=0.1992/0.05 = 3.984V/V

From calculations, gm = 2ID/Vov = (2* 0.5m)/ (0.8 - 0.495) = 3.278m

Rout = Rd = 1.9Kohm

Overall gain :Av = gm * Rd

= 3.278m * 1.9K = 6.22V/V.

3.AC analysis:

![Image](https://github.com/user-attachments/assets/78503986-a7e7-4e81-9ca0-2eed3ec6be68)

From the graph , the gain in dB scale is 12.6dB - 3dB = 9.6dB

4. To calculate maximum input swing and output swing
As calculated earlier,

Vincm = (Vincm_min + Vincm_max)/2 = 1.32V

and Vocm = (Vocm_min + Vocm_max)/2 = 0.977V

Input and output at M1

Input and output at both M1 and M2

## C) Resistor Rss replaced with NMOSFET:

When the tail resistor (R3) is replaced with an NMOS current source, the differential amplifier shows better performance, including higher gain, a wider output swing, and improved common-mode rejection. 
This configuration offers enhanced biasing and stability, outperforming a simple resistor or an ideal current source.

1.DC analysis - To fix the operating point (Q-point):

![Image](https://github.com/user-attachments/assets/6e09441d-dda2-48e4-a0f0-45746c9d8690)

![Image](https://github.com/user-attachments/assets/283ac240-57ac-4b0d-b80e-07237de12d12)

Here the bias voltage(gate voltge of M3) must be calculated to ensure that the mosfet is in saturation region.

It is given by : Vb = Vp + Vtn Vb = 0.4V + 0.49V = 0.89V

![Image](https://github.com/user-attachments/assets/b70d5a01-9a63-425d-866a-a1c950eab4df)

Verified the mosfets are in saturation region by : VGD <=Vtn and VDS >= Vov.

Therefore Q-point of M3 is (0.4V, 1mA) Q-point of M1 and M2 is (0.85V, 0.5mA)

Transient analysis:
Performed the transient analysis keeping the sinusoidal voltage signal DC offset as 1.2V, amplitude 50mV , frequency 1KHz and the AC amplitude as 1V. In the configure analysis, select stop time as 5ms.

Input and output waveforms at M1


![Image](https://github.com/user-attachments/assets/5ec9e246-d967-419b-8576-0f0411812fe2)

Input and output waveforms at M1 and M2


![Image](https://github.com/user-attachments/assets/9abd42d1-116b-4f58-821e-b6d60fcf6f7f)

From the graph ,we can observe the 180 degree phase shift in the output signal and the output voltage (at Vocm node) is amplified

Input voltage amplitude given was 50mV.

From the graph,

Overall Gain(Av) = Vout_peak/Vin_peak = 0.1992V/0.05V = 3.984V/V

From calculations, gm = 2ID/Vov = (2* 0.5m)/ (0.8 - 0.495) = 3.278m

Rout = Rd = 1.9Kohm

Overall gain :Av = gm * Rd

= 3.278m * 1.9K = 6.22V/V

3.AC analysis:

![Image](https://github.com/user-attachments/assets/e6a9f3c1-ed44-4628-9fc1-8f12767e0d65)

rom the graph , the gain in dB scale is 12.6dB - 3dB = 9.6dB

. To calculate maximum input swing and output swing
As calculated earlier,

Vincm = (Vincm_min + Vincm_max)/2 = 1.32V

and Vocm = (Vocm_min + Vocm_max)/2 = 0.977V

Here the dc offset voltage is set to 1.32V, input amplitude to 500mV, to observe the clipped output waveform.

Results and conclusion

Inference:














